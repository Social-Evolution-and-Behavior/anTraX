<!DOCTYPE html>

<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="Asaf Gal" name="author"/>
<link href="../img/favicon.ico" rel="shortcut icon"/>
<title>Using anTraX on HPC environment - anTraX</title>
<link href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" rel="stylesheet" type="text/css"/>
<link href="../css/theme.css" rel="stylesheet" type="text/css">
<link href="../css/theme_extra.css" rel="stylesheet" type="text/css">
<link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet"/>
<script>
    // Current page data
    var mkdocs_page_name = "Using anTraX on HPC environment";
    var mkdocs_page_input_path = "hpc.md";
    var mkdocs_page_url = null;
  </script>
<script defer="" src="../js/jquery-2.1.1.min.js"></script>
<script defer="" src="../js/modernizr-2.8.3.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</link></link></head>
<body class="wy-body-for-nav" role="document">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side stickynav" data-toggle="wy-nav-shift">
<div class="wy-side-nav-search">
<a class="icon icon-home" href=".."> anTraX</a>
<div role="search">
<form action="../search.html" class="wy-form" id="rtd-search-form" method="get">
<input name="q" placeholder="Search docs" title="Type search term here" type="text"/>
</form>
</div>
</div>
<div aria-label="main navigation" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<ul class="current">
<li class="toctree-l1">
<a class="" href="../home/">Home</a>
</li>
<li class="toctree-l1">
<a class="" href="../installation/">Installation</a>
</li>
<li class="toctree-l1">
<a class="" href="../data_organization/">Preparing data for tracking</a>
</li>
<li class="toctree-l1">
<a class="" href="../configuration/">Configuring a tracking session</a>
</li>
<li class="toctree-l1">
<a class="" href="../tracking/">Run the tracking</a>
</li>
<li class="toctree-l1">
<a class="" href="../classification/">Classifying tracklets</a>
</li>
<li class="toctree-l1">
<a class="" href="../propagation/">Graph propagation</a>
</li>
<li class="toctree-l1">
<a class="" href="../validation/">Validating the tracking results</a>
</li>
<li class="toctree-l1">
<a class="" href="../analysis/">Analyzing tracking results</a>
</li>
<li class="toctree-l1">
<a class="" href="../dlc/">Using DeepLabCut for analyzing individual behavior</a>
</li>
<li class="toctree-l1 current">
<a class="current" href="./">Using anTraX on HPC environment</a>
<ul class="subnav">
<li class="toctree-l2"><a href="#installation">Installation</a></li>
<li class="toctree-l2"><a href="#antrax-workflow-on-hpc">anTraX workflow on HPC</a></li>
<li class="toctree-l2"><a href="#batch-run-on-hpc-environment">Batch run on HPC environment</a></li>
</ul>
</li>
<li class="toctree-l1">
<a class="" href="../tips/">Tips and best practices</a>
</li>
</ul>
</div>
       
    </nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">
<nav aria-label="top navigation" class="wy-nav-top" role="navigation">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="..">anTraX</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content">
<div aria-label="breadcrumbs navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a href="..">Docs</a> »</li>
<li>Using anTraX on HPC environment</li>
<li class="wy-breadcrumbs-aside">
<a class="icon icon-github" href="https://github.com/Social-Evolution-and-Behavior/anTraX/edit/master/docs/hpc.md"> Edit on GitHub</a>
</li>
</ul>
<hr/>
</div>
<div role="main"><a class="md-content__icon pdf-download-btn" download href="../pdf/combined.pdf" title="Download"><i class="fa fas fa-download"></i><small> PDF</small></a>
<div class="section">
<h3 id="installation">Installation</h3>
<p>In principle, anTraX installation on an HPC environment is the same as installation on any other Linux machine. The main difference is that typically, you will not have administrator priviliges to intall system-wide packages on the HPC. Luckily, there are not many of those required by anTraX. Also install MATLAB Runtime for version 2019a.</p>
<p>We recommend using a conda environemnt to setup anTraX on HPC, as it enables installation of several packages such as <a href="https://anaconda.org/conda-forge/ffmpeg">ffmpeg</a>. If some pckages are still missing and are not available in conda, work with your system administrator to find a solution.</p>
<p>If you plan on using DeepLabCut, install it into the python environment, and set it to ‘light mode’  in  <code>~/.profile</code>:</p>
<pre><code>export DLClight=True 
</code></pre>
<h3 id="antrax-workflow-on-hpc">anTraX workflow on HPC</h3>
<p>As computer clusters do not typically support interactive work, this will need to be done on a PC. An example for a tracking workflow using a computer cluster will be as follows:</p>
<ol>
<li>Prepare the experimental directory/ies on a PC.</li>
<li>Configure a tracking session for each experimental directory on the PC. </li>
<li>Sync the experimental directories into the HPC environment. </li>
<li>Run batch tracking on the HPC (see below).</li>
<li>If you have a trained blob classifier, jump to step 7. Otherwise, sync tracking results back to the PC, and create a training set using the interactive interface. </li>
<li>Sync again to the HPC, and train the classifier. </li>
<li>Run  the <code>classify</code> and <code>solve</code> commands in batch mode on the HPC.</li>
<li>Sync the results back to the PC.</li>
</ol>
<p>It is recommended to use an incremental tool such as <code>rsync</code> to speed up data transfer. </p>
<h3 id="batch-run-on-hpc-environment">Batch run on HPC environment</h3>
<p>If you are on an HPC environment, using the SLURM workload manager, you can run each of the batch commands (<code>track</code>, <code>classify</code>, <code>solve</code> and <code>dlc</code>) using the <code>--hpc</code> flag:</p>
<pre><code>antrax &lt;command&gt; &lt;experiments&gt; --hpc --hpc-options &lt;opts&gt;
</code></pre>
<p>anTraX will then submit a SLURM job for each experiment, each containing a task for each video in the experiment. </p>
<p>The optional <code>hpc-options</code> argument can controlled some of the SLURM options and accepts a comma seperated list of some of the following options:</p>
<p><code>throttle=&lt;throttle&gt;</code></p>
<p>Number of tasks to run in parallel for each job.</p>
<p><code>partition=&lt;partition&gt;</code></p>
<p>The partition to run in (otherwise, use the system default)</p>
<p><code>email=&lt;email&gt;</code></p>
<p>Send an email for start/end of each job.</p>
</div>
</div>
<footer>
<div aria-label="footer navigation" class="rst-footer-buttons" role="navigation">
<a class="btn btn-neutral float-right" href="../tips/" title="Tips and best practices">Next <span class="icon icon-circle-arrow-right"></span></a>
<a class="btn btn-neutral" href="../dlc/" title="Using DeepLabCut for analyzing individual behavior"><span class="icon icon-circle-arrow-left"></span> Previous</a>
</div>
<hr/>
<div role="contentinfo">
<!-- Copyright etc -->
</div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
</div>
</div>
</section>
</div>
<div class="rst-versions" role="note" style="cursor: pointer">
<span class="rst-current-version" data-toggle="rst-current-version">
<a class="fa fa-github" href="https://github.com/Social-Evolution-and-Behavior/anTraX/" style="float: left; color: #fcfcfc"> GitHub</a>
<span><a href="../dlc/" style="color: #fcfcfc;">« Previous</a></span>
<span style="margin-left: 15px"><a href="../tips/" style="color: #fcfcfc">Next »</a></span>
</span>
</div>
<script>var base_url = '..';</script>
<script defer="" src="../js/theme.js"></script>
<script defer="" src="../search/main.js"></script>
</body>
</html>
